import streamlit as st
import google.generativeai as genai

# Cáº¥u hÃ¬nh trang
st.set_page_config(page_title="Thiáº¿t káº¿ giÃ¡o Ã¡n", layout="wide")

# Giao diá»‡n chÃ­nh
st.title("ğŸ Há»‡ thá»‘ng Thiáº¿t káº¿ GiÃ¡o Ã¡n ThÃ´ng minh")
st.write("Nháº­p thÃ´ng tin bÃ i há»c Ä‘á»ƒ I soáº¡n tháº£o giÃ¡o Ã¡n chi tiáº¿t cho báº¡n.")

# Thanh bÃªn (Sidebar) Ä‘á»ƒ cáº¥u hÃ¬nh API
with st.sidebar:
    st.header("Cáº¥u hÃ¬nh")
    api_key = st.text_input("Nháº­p Gemini API Key:", type="password")
    st.info("Láº¥y API Key miá»…n phÃ­ táº¡i [Google AI Studio](https://aistudio.google.com/)")

# Chia cá»™t Ä‘á»ƒ nháº­p liá»‡u
col1, col2 = st.columns(2)

with col1:
    subject = st.text_input("MÃ´n há»c:", placeholder="VÃ­ dá»¥: ToÃ¡n há»c, Ngá»¯ vÄƒn...")
    grade = st.selectbox("Khá»‘i lá»›p:", [f"Lá»›p {i}" for i in range(1, 13)])
    duration = st.number_input("Thá»i lÆ°á»£ng (phÃºt):", min_value=35, max_value=180, value=45)

with col2:
    lesson_title = st.text_input("TÃªn bÃ i há»c:", placeholder="VÃ­ dá»¥: Äáº¡o hÃ m, Chiáº¿n dá»‹ch Äiá»‡n BiÃªn Phá»§...")
    teaching_method = st.multiselect(
        "PhÆ°Æ¡ng phÃ¡p giáº£ng dáº¡y:",
        ["Thuyáº¿t trÃ¬nh", "Tháº£o luáº­n nhÃ³m", "TrÃ² chÆ¡i", "Thá»±c hÃ nh", "Dáº¡y há»c dá»± Ã¡n"],
        default=["Thuyáº¿t trÃ¬nh"]
    )

objectives = st.text_area("Má»¥c tiÃªu bÃ i há»c (Mong muá»‘n há»c sinh Ä‘áº¡t Ä‘Æ°á»£c gÃ¬?):")

# NÃºt thá»±c hiá»‡n
if st.button("ğŸš€ Báº¯t Ä‘áº§u soáº¡n giÃ¡o Ã¡n"):
    if not api_key:
        st.error("Vui lÃ²ng nháº­p API Key á»Ÿ thanh bÃªn trÃ¡i!")
    elif not lesson_title or not objectives:
        st.warning("Vui lÃ²ng Ä‘iá»n tÃªn bÃ i há»c vÃ  má»¥c tiÃªu!")
    else:
        # Tá»± Ä‘á»™ng thiáº¿t káº¿ Prompt máº«u
        methods_str = ", ".join(teaching_method)
        prompt_mau = f"""
        Báº¡n lÃ  má»™t chuyÃªn gia giÃ¡o dá»¥c dÃ y dáº·n kinh nghiá»‡m. HÃ£y soáº¡n má»™t giÃ¡o Ã¡n chi tiáº¿t cho:
        - MÃ´n: {subject}
        - Lá»›p: {grade}
        - TÃªn bÃ i há»c: {lesson_title}
        - Thá»i lÆ°á»£ng: {duration} phÃºt.
        - PhÆ°Æ¡ng phÃ¡p Æ°u tiÃªn: {methods_str}.
        - Má»¥c tiÃªu: {objectives}.
        
        YÃªu cáº§u giÃ¡o Ã¡n bao gá»“m cÃ¡c pháº§n:
        1. Má»¥c tiÃªu bÃ i há»c (Kiáº¿n thá»©c, Ká»¹ nÄƒng, ThÃ¡i Ä‘á»™).
        2. Thiáº¿t bá»‹ dáº¡y há»c cáº§n chuáº©n bá»‹.
        3. Tiáº¿n trÃ¬nh dáº¡y há»c (Chia theo cÃ¡c bÆ°á»›c: á»”n Ä‘á»‹nh, Kiá»ƒm tra, Khá»Ÿi Ä‘á»™ng, KhÃ¡m phÃ¡, Luyá»‡n táº­p, Váº­n dá»¥ng).
        4. CÃ¡c cÃ¢u há»i gá»£i má»Ÿ cho há»c sinh.
        TrÃ¬nh bÃ y báº±ng Ä‘á»‹nh dáº¡ng Markdown rÃµ rÃ ng, chuyÃªn nghiá»‡p.
        """
        
        try:
            # Káº¿t ná»‘i Gemini
            genai.configure(api_key=api_key)
            model = genai.GenerativeModel('gemini-1.5-flash')
            
            with st.spinner("Äang thiáº¿t káº¿ giÃ¡o Ã¡n, vui lÃ²ng Ä‘á»£i trong giÃ¢y lÃ¡t..."):
                response = model.generate_content(prompt_mau)
                
            # Hiá»ƒn thá»‹ káº¿t quáº£
            st.divider()
            st.subheader("ğŸ“„ GiÃ¡o Ã¡n chi tiáº¿t")
            st.markdown(response.text)
            
            # NÃºt táº£i xuá»‘ng (tÃ¹y chá»n)
            st.download_button(
                label="Táº£i giÃ¡o Ã¡n vá» mÃ¡y (.txt)",
                data=response.text,
                file_name=f"Giao_an_{lesson_title}.txt",
                mime="text/plain"
            )
            
        except Exception as e:
            st.error(f"ÄÃ£ xáº£y ra lá»—i: {str(e)}")

# ChÃ¢n trang
st.markdown("---")
st.caption("á»¨ng dá»¥ng Ä‘Æ°á»£c phÃ¡t triá»ƒn trÃªn ná»n táº£ng Streamlit & Gemini API")